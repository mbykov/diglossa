# Diglossa.js - инструмент медленного чтения

## tldr

diglossa.js - приложение для чтения и редактирования электронных книг в формате .dgl. Dgl-пакет может иметь как один текст книги, так и несколько параллельных текстов. Для синхронизации параллельных тектстов возможно использование авто-синхронизации. На основе многоязычных .dgl-пакетов (книг) возможна генерация .dgl-словарей, то есть результатов полнотекстового поиска для всех слов текста. Из множества .dgl-словарей возможна генерация тематических контекстных многоязычных словарей (contextual multilingual dictionaries - CMD). CMD - выборка фраз по определенной теме вместе с их параллельными переводами из всех имеющихся .dgl-словарей.

diglossa.js бесплатна, имеет модульную структуру, открытый код, свободную лицензию GNU GPL и интуитивно ясный интерфейс. Может использоваться просто как удобная читалка любых электронных книг.

## формат dgl

dgl - формат электронных книг, подобный формату epub, но имеющий два отличия.

- во-первых, внутри он использует не html, но (псевдо-) markdown.
- во-вторых, он не имеет специального файла оглавления .toc, но использует саму разметку markdown для построения оглавления.

во всем остальном .dgl копирует .epub, его можно назвать версией .epub-markdown, все возможности .epub сохранены.

псевдо-markdown - потому что из блоковых тегов используется только один - p, или paragraph. Заголовки h(n), абзацы, и строки в списках и в таблицах представляются тегами p. Таким образом, текст книги преобразуется в последовательность абзацев.

в силу этого формате .dgl могут быть легко сопоставлены два или более параллельных текста. Любой текст (а текст в общем случае - дерево данных) - становится плоской последовательностью объектов, содержащих значащую строку. Это позволяет очень быстро эту последовательность обрабатывать, не связываясь с обработкой деревьев. При синхронизации книг каждому объекту (обычно абзацу) ставится в соответсвие такой же по номеру объект синхронизируемой книги. Разделы книг синхронизируются один за другим последовательно, чтобы избежать обработки больших массивов.

## основные возможности:

### чтение:
- импорт книг: .epub, .pdf, .fb2, .html, .md, .txt и - собственно формат .dgl
- автоматическое определение языка текста (см. franc)
- импорт словарей - .stardict, .dsl
- вызов соответствующего словаря для каждого слова по alt-mouse-move
- локальный и полнотекстовый поиск
- закладки

### редактирование:

- импорт и параллельное подключение переводов той же книги
- редактирование логической структуры книги
- автоматическая проверка синхронизации абзацев
- экспорт синхронизированных книг в формате .dgl
- генерация многоязычных контекстных dgl-словарей
- публикация параллельных книг и контекстных словарей

### кроме того,
- использование плагинов для подключения любого языка

## редактирование логической структуры книги

  команды:

  - ctrl+e - вход в режим редактирования
  - esc - выход из режима редактирования без сохранения
  - ctrl+s - сохранение результатов
  - ctrl+z - undo
  - ctrl+y - запуск авто-проверки синхронизации абзацев

  в режиме редактирования:

  - d - delete
  - c - copy
  - e - empty
  - m - merge
  - b - break
  - ia - insert after
  - ib - insert before
  -
  - arraw-right - понизить уровень заголовка (только в оглавлении)
  - arraw-left - повысить уровень заголовка (только в оглавлении)

  undo можно делать сколько угодно раз, можно выйти из режима редактирования, читать другую книгу, а затем вернуться и продолжить редактирование или выполнить undo в любое время. История реактирования теряется только при экспорте книги в готовый .dgl-пакет.

## автоматическая проверка синхронизации абзацев

при синхронизации в текст книги исправления не вносятся, но создается синхронизатор. Это позволяет в любой момент откатить внесенные изменения, даже вернувшись к редактированию книги после редактирования или чтения иной книги, или рестарта диглоссы.

автоматическая проверка синхронизации абзацев значительно ускоряет работу. Авто-синхронизатор работает так:

вначале проверяются два простых очевидных правила: 1) если оба предложения короткие, проверка проходит. А 2) если одно предложение более чем вдвое длиннее другого, проверка не проходит.

затем стартует собственно авто-синхронизатор. Для значимых словоформ исходного языка определяются стемы. Для каждого стема определяются соответствия в языке перевода. Для каждой пары языков разработаны специальные словари соответствия стемов. Если такого словаря для данной пары языков еще нет, авто-синхронизатор работать не сможет. (Ручное редактирование от этого не зависит). Т.о. по словоформам языка оригинала создается массив возможных стемов языка перевода. И создается массив наличных стемов языка перевода. Если эти массивы имеют пересечение, проверка проходит.

если проверка прошла, абзац отмечается зеленой лампочкой, текст прокручивается к следующему абзацу и проверка повторяется для него.

в первый раз для авто-синхронизации требуется коннект с сетью . Специальные словари стемов не включены в дистрибутив diglossa.js, их много - для каждой пары языков, они большие, и они находятся в постоянном процессе разработки и дополнения. Однако, никакого ожидания загрузки словарей не требуется, синхронизация стартует сразу. Параллельно и незаметно для пользователя необходимый словарь стемов клонируется с сервера, благодаря волшебным свойствам CouchDB. А спустя несколько минут дальнейший коннект с сетью не требуется.

как видите, авто-синхронизатор - довольно грубая, но вполне эффективная методика.


## лингвистика и герменевтика

в приложении Diglossa.js не используется никакой лингвистики, не делаются никакие предположения о теории языка. Используется лишь честное сравнение и преобразование строк. Если вы представите современную тенденцию по развитию систем автоматического перевода и искусственного интеллекта, и развернете ее мысленно на полностью противоположную, в результате вы получите указание именно на Diglossa.js.

целью Diglossa.js является не изучение языка, а понимание автора текста, беседа с автором. Diglossa.js - инструмент медленного чтения.




*
